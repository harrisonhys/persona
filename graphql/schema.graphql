"A datetime string with format 'Y-m-d H:i:s', e.g. '2018-05-23 13:43:32'."
scalar DateTime @scalar(class: "Nuwave\\Lighthouse\\Schema\\Types\\Scalars\\DateTime")

"User object"
type User {
    id: ID!
    name: String!
    email: String!
    created_at: DateTime!
    updated_at: DateTime!
}

type Campaign {
    id: ID!
    title: String!
    status: CampaignStatus!
    "Returns the metadata as a JSON string"
    metadata: String @rename(attribute: "metadata_string")
    created_at: DateTime!
    updated_at: DateTime!
}

enum CampaignStatus {
    DRAFT
    ACTIVE
    ARCHIVED
}

type Query {
    users: [User!]! @all @guard
    user(id: ID @eq): User @find @guard
    
    campaigns(status: CampaignStatus @eq): [Campaign!]! @paginate(defaultCount: 10) @guard
    campaign(id: ID @eq): Campaign @find @guard
}

input MaintainCampaignInput {
    title: String! @rules(apply: ["required", "min:3"])
    status: CampaignStatus
    "Pass a valid JSON string"
    metadata_json: String @rules(apply: ["json"])
}

type Mutation {
    maintainCampaign(id: ID, input: MaintainCampaignInput!): Campaign! 
        @field(resolver: "App\\GraphQL\\Mutations\\MaintainCampaign")
    
    "Create a new article"
    createArticle(input: CreateArticleInput!): Article! 
        @guard
        @field(resolver: "App\\GraphQL\\Mutations\\CreateArticle")
    
    "Update an existing article"
    updateArticle(id: ID!, input: UpdateArticleInput!): Article! 
        @guard
        @field(resolver: "App\\GraphQL\\Mutations\\UpdateArticle")
    
    "Publish an article (requires review)"
    publishArticle(id: ID!): Article! 
        @guard
        @field(resolver: "App\\GraphQL\\Mutations\\PublishArticle")
    
    "Unpublish an article"
    unpublishArticle(id: ID!): Article! 
        @guard
        @field(resolver: "App\\GraphQL\\Mutations\\UnpublishArticle")
    
    "Review an article"
    reviewArticle(id: ID!, approved: Boolean!): Article! 
        @guard
        @field(resolver: "App\\GraphQL\\Mutations\\ReviewArticle")
    
    "Soft delete an article"
    deleteArticle(id: ID!): Boolean! 
        @guard
        @field(resolver: "App\\GraphQL\\Mutations\\DeleteArticle")
    
    "Restore a deleted article"
    restoreArticle(id: ID!): Article! 
        @guard
        @field(resolver: "App\\GraphQL\\Mutations\\RestoreArticle")
}

"Article type"
type Article {
    id: ID!
    slug: String!
    title: String!
    content: String!
    content_rewrite: String
    
    "Comma-separated categories"
    category: String
    
    "Comma-separated labels"
    label: String
    
    "Categories as array"
    category_list: [String!]
    
    "Labels as array"
    label_list: [String!]
    
    is_reviewed: Boolean!
    published_at: DateTime
    
    "Audit trail - user names"
    created_by: String
    updated_by: String
    edited_by: String
    published_by: String
    deleted_by: String
    
    created_at: DateTime!
    updated_at: DateTime!
    deleted_at: DateTime
}

enum ArticleStatus {
    DRAFT
    PUBLISHED
}

input CreateArticleInput {
    slug: String
    title: String! @rules(apply: ["required", "min:3", "max:255"])
    content: String! @rules(apply: ["required"])
    content_rewrite: String
    category: String
    label: String
}

input UpdateArticleInput {
    slug: String
    title: String @rules(apply: ["min:3", "max:255"])
    content: String
    content_rewrite: String
    category: String
    label: String
}

input ArticleFilters {
    category: String
    label: String
    is_reviewed: Boolean
    status: ArticleStatus
    search: String
}

extend type Query {
    "Get single article by ID or slug"
    article(id: ID, slug: String): Article @guard @field(resolver: "App\\GraphQL\\Queries\\Article")
    
    "List articles with filters and pagination"
    articles(
        filters: ArticleFilters
        first: Int = 10
        page: Int
    ): [Article!]! @guard @field(resolver: "App\\GraphQL\\Queries\\Articles")
}

